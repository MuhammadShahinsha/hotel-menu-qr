<!DOCTYPE html>
<html>
<head>
    <title>Kitchen Dashboard</title>

    <style>
        body {
            background: #020617;
            color: white;
            font-family: Poppins, Arial;
            padding: 20px;
        }

        h1 {
            color: #facc15;
        }

        .order {
            background: #0f172a;
            padding: 18px;
            margin-bottom: 18px;
            border-left: 6px solid #22c55e;
            border-radius: 10px;
        }

        .table {
            font-size: 1.4rem;
            font-weight: bold;
            color: #38bdf8;
        }

        .items {
            margin-top: 8px;
            font-size: 1.05rem;
        }

        .total {
            margin-top: 8px;
            font-weight: bold;
            color: #a7f3d0;
        }

        .time {
            margin-top: 6px;
            font-size: 0.85rem;
            color: #94a3b8;
        }
    </style>
</head>

<body>

<h1>üç≥ Kitchen Orders</h1>

<!-- üîî Alert Sound -->
<audio id="alertSound" preload="auto">
    <source src="/static/sound/order.mp3.wav" type="audio/wav">
</audio>

<button id="enableSound" style="
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 10px 16px;
    font-size: 14px;
    font-weight: bold;
    border-radius: 8px;
    border: none;
    background: #22c55e;
    color: #020617;
    cursor: pointer;
    z-index: 9999;
">
üîä Enable Sound
</button>

<audio id="alertSound" preload="auto">
    <source src="/static/sound/order.mp3.wav" type="audio/wav">
</audio>

<script>
    let lastOrderCount = {{ orders|length }};
    let soundEnabled = false;

    document.getElementById("enableSound").addEventListener("click", () => {
        const sound = document.getElementById("alertSound");
        sound.play().then(() => {
            sound.pause();
            sound.currentTime = 0;
            soundEnabled = true;
            document.getElementById("enableSound").innerText = "‚úÖ Sound Enabled";
        });
    });

    setInterval(() => {
        fetch("/kitchen_count")
            .then(res => res.json())
            .then(data => {
                if (data.count > lastOrderCount) {
                    if (soundEnabled) {
                        const sound = document.getElementById("alertSound");
                        sound.currentTime = 0;
                        sound.play();
                    }
                    lastOrderCount = data.count;
                    window.location.reload();
                }
            });
    }, 5000);
</script>

{% for o in orders %}
<div class="order">
    <div class="table">ü™ë Table {{ o[0] }}</div>
    <div class="items">üçΩ {{ o[1] }}</div>
    <div class="total">üí∞ Total: ‚Çπ{{ o[2] }}</div>
    <div class="time">‚è∞ {{ o[3] }}</div>
</div>
{% endfor %}

</body>
</html>
